#!/usr/bin/env python
# Redirect to a random file

from os.path import join,split
from os      import walk,environ
from random  import choice
from sys     import argv

# Approve the candidates
def ok_choice(f):
    parts = split(f)
    return not (parts[1].startswith('.') or parts[1].startswith('Index'))
    
    
# Feature a single line of the input stream
def pick_random(lines):
    lines = filter(ok_choice, lines)
    if len(lines)<1:
        print 'No choices available'
    return choice(lines)

# Recursive list
def recursive_list(d):
    matches = []
    for root, dirnames, filenames in walk(d):
        for filename in filenames:
            matches.append(join(root, filename))
    return matches

if len(argv)<1:
    print 'usage: ',argv[0],'directory'
    exit(1)

d = argv[1]
base = environ['pd']+'/'
f = pick_random(recursive_list(d))
f = f.replace(base,'')
f = f[f.find('/')+1:]
print 'redirect:'+f
