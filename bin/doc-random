#!/usr/bin/env python
# Redirect to a random file

from os.path import join,split,exists
from os      import environ,system
from random  import choice
from sys     import argv
from files   import list_files


# Feature a single line of the input stream
def pick_random(lines):
    if len(lines)<1:
        print 'No choices available'
    return choice(lines)


# Approve the candidates
def ok_choice(f):
    parts = split(f)
    return not (parts[1].startswith('.') or parts[1].startswith('Index'))
    

if len(argv)<1:
    print 'usage: ',argv[0],'directory'
    exit(0)

d = argv[1]
base = environ['pd']+'/'
if not exists(base):
    print 'No doc directory exists: ',base
    exit(0)

lines = list_files(base+d)
lines = filter(ok_choice, lines)
f = './'+d+'/'+pick_random(lines)
if not exists(base+f):
    print 'No doc exists: ',base+f
    exit(0)

print '<a href="Index">Index</a>'
print '<a href=".random">Next</a>'
system('doc-show '+f)
