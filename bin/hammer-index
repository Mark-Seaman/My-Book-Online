#!/usr/bin/env python
# Create the index for a given user
from os.path import join
from os      import environ
from sys     import argv

from files   import do_command


intro_text = '''* %s *
Welcome to AppThumper.

Which app do you want to thump today?


 * [[Apps][Configure your apps]]'''

def app_links(text,files):
    for x in files:
        if len(x)>0:
            text.append(' * [[%s/Index][%s]]'%(x,x))


def index_text(user):
    text = [ intro_text%user ]
    f = join(environ['pd'],user,'.apps') 
    files = open(f).read().split('\n')
    app_links(text,files)
    text.append('')
    return text


user = 'Anonymous'
if len(argv)>1:
    user = argv[1]

text = index_text(user)
text = '\n'.join(text)
print do_command('hammer-wiki', text)
